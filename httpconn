Option Explicit

Dim shell, exec, output, json, unity_id, version

Set shell = CreateObject("WScript.Shell")

' Ejecuta curl
Set exec = shell.Exec("cmd /c curl -s -i -H ""Authorization: Bearer XXXX"" -X POST ""https://...""")

output = ""
Do While Not exec.StdOut.AtEndOfStream
    output = output & exec.StdOut.ReadLine() & vbCrLf
Loop

' Extrae solo la parte JSON (asumiendo que viene después de cabeceras HTTP)
Dim pos
pos = InStr(output, "{")
If pos > 0 Then
    json = Mid(output, pos)
Else
    WScript.Echo "No se encontró JSON en la respuesta"
    WScript.Quit
End If

' Parseo simple usando ScriptControl
Dim sc
Set sc = CreateObject("MSScriptControl.ScriptControl")
sc.Language = "JScript"
sc.AddCode "function parseJson(){return " & json & ";}"

unity_id = sc.Eval("parseJson().unity_id")
version  = sc.Eval("parseJson().version")

WScript.Echo "unity_id: " & unity_id
WScript.Echo "version: " & version
